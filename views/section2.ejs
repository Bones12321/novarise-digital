<%- include('partials/header', { title: title, cart }) %>

<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background: url('/images/mind-mastery-bg.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #333;
  }

  .description {
    text-align: center;
    max-width: 700px;
    margin: 40px auto 40px;
    font-size: 1.1rem;
    color: #fff;
    font-weight: bold;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
  }

  h1 {
    text-align: center;
    margin-top: 40px;
    font-size: 2.5rem;
    color: #fff;
    font-weight: 900;
    text-shadow: 0 2px 8px rgba(0,0,0,0.8);
  }

  .products-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto 80px auto;
  }

  .product-box {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(12px);
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    text-align: center;
    color: #222;
  }

  .product-box:hover {
    transform: scale(1.03);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .product-box img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 15px;
  }

  .product-box h2 {
    font-size: 1.2rem;
    margin-bottom: 10px;
    color: #111;
  }

  .product-box p {
    font-size: 1rem;
    margin-bottom: 15px;
    color: #333;
  }

  .product-box button {
    width: 100%;
    padding: 10px 0;
    font-size: 1rem;
    border: none;
    border-radius: 25px;
    background-color: #222;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .product-box button:hover {
    background-color: #444;
  }

  .quote {
    text-align: center;
    margin: 40px auto 40px;
    font-size: 1.5rem;
    font-style: italic;
    color: #fff;
    font-weight: bold;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
  }

  .cart-count {
    background: crimson;
    color: #fff;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.9rem;
    margin-left: 5px;
  }

  /* === MOBILE-ONLY CHANGES === */
  @media (max-width: 768px) {
    /* Glassy box for description */
    .description {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px) saturate(180%);
      -webkit-backdrop-filter: blur(10px) saturate(180%);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
      color: #111;
      padding: 25px 20px;
      text-shadow: none;
      font-weight: bold;
      font-size: 1.1rem;
      max-width: 90%;
      margin-bottom: 40px;
    }

    /* Smaller products and two per row */
    .products-container {
      grid-template-columns: repeat(2, 1fr);
      max-width: 100%;
      padding: 10px;
    }

    .product-box img {
      height: 140px;
    }

    .product-box h2 {
      font-size: 1rem;
    }

    .product-box p {
      font-size: 0.9rem;
    }
  }
</style>

<main>
  <h1><%= title %></h1>

  <p class="description">
    Unlock the power of your mind with our expertly crafted digital tools. From building resilience to mastering focus, our Mind Mastery guides provide actionable steps to elevate your mental strength. Designed for busy night builders and dream chasers, these resources empower you to create lasting change. Dive into interactive courses, reflective journals, and scientifically backed techniques. Your journey to mental mastery starts here.
  </p>

  <div class="products-container">
    <% products.forEach(product => { %>
      <div class="product-box">
        <% if (product.image) { %>
          <img src="<%= product.image %>" alt="<%= product.title %>" />
        <% } else { %>
          <div style="height:180px; display:flex; align-items:center; justify-content:center; background:#ccc; border-radius:8px; margin-bottom:15px; color:#777;">
            Image Coming Soon
          </div>
        <% } %>
        <h2><%= product.title %></h2>
        <p>$<%= product.price.toFixed(2) %></p>

        <button class="add-to-cart-btn" 
          data-id="<%= product.title.replace(/\s+/g, '-').toLowerCase() %>" 
          data-name="<%= product.title %>" 
          data-price="<%= product.price %>">
          Add to Basket
        </button>
      </div>
    <% }) %>
  </div>

  <p class="quote">
    "The mind is a powerful force; harness it with intention and watch your life transform." â€“ NovaRise
  </p>
</main>

<!-- Footer -->
<%- include('partials/footer') %>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', async () => {
      const id = button.dataset.id;
      const name = button.dataset.name;
      const price = button.dataset.price;

      try {
        const response = await fetch('/cart/add', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ id, name, price, quantity: 1 }),
        });

        if (response.ok) {
          const data = await response.json();

          const badge = document.querySelector('nav .badge');
          if (badge) {
            if (data.cartCount > 0) {
              badge.textContent = data.cartCount;
              badge.style.display = 'inline-block';
            } else {
              badge.style.display = 'none';
            }
          }

          alert(`Added "${name}" to basket!`);
        } else {
          alert('Failed to add to basket. Please try again.');
        }
      } catch (error) {
        console.error('Error adding to cart:', error);
        alert('An error occurred. Please try again later.');
      }
    });
  });
</script>
